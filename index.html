<!doctypehtml><html lang=en><meta charset=UTF-8><title>LiquidSonics Coupon Optimizer</title><style>body{font-family:sans-serif;padding:20px}#results{width:100%;height:300px;margin-top:10px;font-family:monospace}.checkbox-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;margin-bottom:20px}.discount-checkbox{margin-bottom:20px}.coupon-row{display:flex;align-items:center;gap:10px}.coupon-row input[type=number]{width:50px}</style><h1>LiquidSonics Coupon Optimizer</h1><h5>Now assumes coupons can be used multiple times (thanks, bossanova@RGO)</h5><p>Select the coupons you already have:<div class=checkbox-container id=couponCheckboxes></div><p>Select the products you want to purchase:<div class=checkbox-container id=productCheckboxes></div><div class=discount-checkbox><input id=educationalDiscountCheckbox type=checkbox> <label for=educationalDiscountCheckbox>Educational Discount (30%)</label></div><button id=computeButton>Optimize Purchases</button> <textarea id=results readonly></textarea><script>let products={"Tai Chi Lite":29,"Lustrous Plates":99,"HD Cart":99,"Seventh Heaven":49,"Seventh Heaven Professional":179,Illusion:99,"Cinematic Rooms Professional":249,"Cinematic Rooms":129,"Lustrous Plates Surround":149,"Tai Chi":99,"M7 Link":99,"Reverberate 3":49},couponsGiven={"Cinematic Rooms Professional":[30],"Seventh Heaven Professional":[25],Illusion:[22.5],"Lustrous Plates Surround":[22.5],"Cinematic Rooms":[20],"Lustrous Plates":[20],"Tai Chi":[20],"HD Cart":[20],"M7 Link":[20],"Reverberate 3":[10],"Tai Chi Lite":[10],"Seventh Heaven":[5]};function*getPartitions(e){if(1===e.length)yield[e];else{var o,t=e[0];for(o of getPartitions(e.slice(1))){for(let e=0;e<o.length;e++){var n=o[e];yield[...o.slice(0,e),[t,...n],...o.slice(e+1)]}yield[[t],...o]}}}function tuplefy(e){return Array.from(e).sort((e,o)=>e-o).toString()}function simulate(n,r,i,a,l={}){var u=`${r}-${tuplefy(i)}-`+a;if(!(u in l)){if(r===n.length)return[0,[]];let e=1/0,o=[];var s,c=n[r],p={};let t=0;for(s of c)p[s]=products[s],t+=products[s];t;var d,f=Array.from(i),m=[[]];for(let e=1;e<=f.length;e++)for(var h of getCombinations(f,e))m.push(h);for(d of m){var v,C=[],g=[];0<a&&(C.push(1-a/100),g.push(a));for(v of d)C.push(1-v/100),g.push(v);var P,y=C.reduce((e,o)=>e*o,1),y=t*y,b={"Purchase Number":r+1,Products:c,"Original Prices":p,"Total Original Price":t,"Price after Educational Discount":0<a?t*(1-a/100):null,"Coupons Applied":g,"Price after Coupons":y,"Coupons Used":d.slice(),"Coupons Available Before":Array.from(i)},E=i.slice();for(P of c)if(couponsGiven[P])for(var $ of couponsGiven[P])E.push($);var[x,A]=simulate(n,r+1,E,a,l),y=y+x;y<e&&(e=y,o=[b,...A])}l[u]=[e,o]}return l[u]}function*getCombinations(o,t){if(0===t)yield[];else for(let e=0;e<=o.length-t;e++){var n,r=o[e];for(n of getCombinations(o.slice(e+1),t-1))yield[r,...n]}}function*getPermutations(o){if(1===o.length)yield o.slice();else for(let e=0;e<o.length;e++){var t,n=o[e];for(t of getPermutations(o.slice(0,e).concat(o.slice(e+1))))yield[n,...t]}}function optimize(){var r=Array.from(document.querySelectorAll('input[name="product"]:checked')).map(e=>e.value);if(0===r.length)alert("Please select at least one product.");else{let n=[];document.querySelectorAll(".coupon-row").forEach(e=>{var t=e.querySelector('input[name="coupon"]'),e=e.querySelector('input[type="number"]');if(t&&t.checked){let o=parseInt(e.value,10);(isNaN(o)||o<1)&&(o=1);for(let e=0;e<o;e++)n.push(parseFloat(t.value))}});var i,a=document.getElementById("educationalDiscountCheckbox").checked?30:0,l=n.slice();let e=1/0,o=null,t=null;for(i of Array.from(getPartitions(r)))for(var u of getPermutations(i)){var[s,c]=simulate(u,0,l,a,{});s<e&&(e=s,o=[i,u],t=c.slice())}displayResults(o,t,e)}}function displayResults(e,o,t){var n,r=document.getElementById("results");let i=`Best Strategy:
`;i+=`Purchase Order:
`,e[1].forEach((e,o)=>{i+=`  Purchase ${o+1}: ${e}
`}),i+=`
Detailed Steps:
`;for(n of o)i=(i=(i+=`
Purchase ${n["Purchase Number"]}: Buying ${n.Products.join(", ")}
`)+`  Original Prices: ${Object.entries(n["Original Prices"]).map(([e,o])=>e+": $"+o.toFixed(2)).join(", ")}
`)+`  Total Original Price: $${n["Total Original Price"].toFixed(2)}
`,null!==n["Price after Educational Discount"]&&(i+=`  Price after Educational Discount: $${n["Price after Educational Discount"].toFixed(2)}
`),i=(i=(i=(i+=`  Coupons Applied: ${0<n["Coupons Applied"].length?n["Coupons Applied"].map(e=>e+"%").join(", "):"None"}
`)+`  Price after Coupons: $${n["Price after Coupons"].toFixed(2)}
`)+`  Coupons Used: ${0<n["Coupons Used"].length?n["Coupons Used"].map(e=>e+"%").join(", "):"None"}
`)+`  Coupons Available Before Purchase: ${0<n["Coupons Available Before"].length?n["Coupons Available Before"].map(e=>e+"%").join(", "):"None"}
`;i+=`
Lowest Total Cost: $${t.toFixed(2)}
`,r.value=i}function populateCheckboxes(){var e,o=document.getElementById("productCheckboxes");for(e in products){var t=document.createElement("div"),n=document.createElement("input"),r=(n.type="checkbox",n.name="product",n.value=e,n.id="product-"+e.replace(/ /g,"-"),document.createElement("label"));r.htmlFor="product-"+e.replace(/ /g,"-"),r.textContent=e,t.appendChild(n),t.appendChild(r),o.appendChild(t)}}function populateCouponCheckboxes(){var e,o,t=document.getElementById("couponCheckboxes"),n=new Set;for(e of Object.values(couponsGiven))for(var r of e)n.add(r);for(o of Array.from(n).sort((e,o)=>o-e)){var i=document.createElement("div"),a=(i.classList.add("coupon-row"),document.createElement("input")),l=(a.type="checkbox",a.name="coupon",a.value=o,a.id="coupon-"+o.toString().replace(".","-"),document.createElement("label")),u=(l.htmlFor="coupon-"+o.toString().replace(".","-"),l.textContent=o+"% Coupon",document.createElement("input"));u.type="number",u.min="1",u.value="1",i.appendChild(a),i.appendChild(l),i.appendChild(u),t.appendChild(i)}}window.onload=()=>{populateCouponCheckboxes(),populateCheckboxes(),document.getElementById("computeButton").addEventListener("click",optimize)}</script>
